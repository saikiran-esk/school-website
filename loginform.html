<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body { background-color: whitesmoke; font-family: Arial; }
input { padding: 10px; width: 250px; margin: 8px; }
input[type="submit"] { background: green; color: white; cursor: pointer; }
</style>

</head>
<body>

<h2 align="center">Login</h2>

<form onsubmit="loginUser(); return false;" align="center">
    USERNAME:<br>
    <input id="username" type="text" placeholder="Enter username"><br><br>

    EMAIL:<br>
    <input id="email" type="text" placeholder="Enter email"><br><br>

    PASSWORD:<br>
    <input id="pass" type="password" placeholder="Enter password"><br><br>

    <input type="submit" value="Login"><br><br>

    <a href="#" id="forgotLink" style="color:red;">Forgot Password?</a><br><br>
    <a href="signup.html">Create New Account</a>
</form>

<script>
// Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyAlAT2IBGRo0pTlrfK6QqmIx368UcyFZqI",
    authDomain: "school-web-9599f.firebaseapp.com",
    projectId: "school-web-9599f",
    storageBucket: "school-web-9599f.firebasestorage.app",
    messagingSenderId: "941617380658",
    appId: "1:941617380658:web:411a50d9d350638b0dab2b",
    measurementId: "G-QMTK4DC6LP"
  };

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
</script>

<script>
// LOGIN FUNCTION
function loginUser() {
    const username = document.getElementById("username").value;
    const email = document.getElementById("email").value;
    const password = document.getElementById("pass").value;

    if (!username || !email || !password) {
        alert("Fill all fields");
        return false;
    }

    auth.signInWithEmailAndPassword(email, password)
    .then((userCredential) => {
        const uid = userCredential.user.uid;

        db.collection("users").doc(uid).get()
        .then((doc) => {
            if (doc.exists && doc.data().username === username) {
                alert("Login Successful!");
                window.location.href = "students.html";
            } else {
                alert("Username does not match this email!");
            }
        });
    })
    .catch((error) => {
        alert(error.message);
    });

    return false;
}
</script>

<script>
// FORGOT PASSWORD
document.getElementById("forgotLink").addEventListener("click", function(e) {
    e.preventDefault();
    const email = document.getElementById("email").value;

    if (!email) {
        alert("Enter your email first");
        return;
    }

    auth.sendPasswordResetEmail(email)
        .then(() => alert("Password reset link sent"))
        .catch(err => alert(err.message));
});
</script>

</body>
</html>
